<!doctype html>
<title>/</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
    * {
        font: 18px monospace;
    }
    .header {
        border-bottom: 2px solid black;
        padding-top: 10px;
        padding-bottom: 15px;
    }
    .headertext{
        font-weight: bold;
    }
    a {
        text-decoration: none;
        font-weight: inherit;
    }
</style>

<div class='header'>
    <span class='headertext'><a href='/'>Chat Anarchy</a> | <a href='join'>Join Room</a> | <a href='/about'>About</a></span>
</div>

<input autofocus style="width:75%">
<script src=/socket.io/socket.io.js></script>
<script>
    document.title = location.pathname;
    var socket = io()
        .on('connect', function() {
            socket.emit('join', location.pathname);
        })
        .on('joined', function(user) {
            log(user + ' joined.');
        })
        .on('message', function(data) {
            log(data.m, data.u);
        })
        .on('left', function(user) {
            log(user + ' left.');
        });

    var input = document.getElementsByTagName('input')[0];
    input.onchange = function() {
        socket.send(this.value);
        this.value = '';
    };
    
    function log(message, user) {
        if(user){
            var username = document.createElement('span');
            username.appendChild(document.createTextNode(user + ': '));
            username.title = Date();
            username.style.fontWeight = "bold";

            var usermessage = document.createElement('span');
            usermessage.appendChild(document.createTextNode(message));
            usermessage.style.fontWeight = "normal";
            usermessage.title = Date();
            
            var newline = document.createElement('p');
            newline.appendChild(document.createTextNode(''));

            document.body.insertBefore(username, input);
            document.body.insertBefore(usermessage, input);
            document.body.insertBefore(newline, input);
            newline.scrollIntoView();
        } else {
            var status = document.createElement('p');
            status.appendChild(document.createTextNode(message));
            status.title = Date();
            status.style.fontStyle = "italic";
            
            document.body.insertBefore(status, input);
            status.scrollIntoView();
        }
    }
</script>